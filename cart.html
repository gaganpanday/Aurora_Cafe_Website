<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Café Aurora — Cart</title>
  <link rel="stylesheet" href="style.css">
  <style>
  .cart-wrap{padding:48px 0}
  .cart-grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
  .cart-list .card{overflow:hidden}
  .cart-row{display:grid;grid-template-columns:80px 1fr auto auto auto auto;gap:12px;align-items:center;padding:12px;border-bottom:1px solid rgba(148,163,184,.12)}
  .cart-row:last-child{border-bottom:0}
  .cart-row img{width:80px;height:60px;object-fit:cover;border-radius:10px}
  .muted-sm{color:var(--muted);font-size:12px}
  .right{text-align:right}
  .qty{display:flex;align-items:center;border:1px solid rgba(148,163,184,.25);border-radius:12px;overflow:hidden}
  .qty button{width:32px;height:32px;background:transparent;color:#fff;border:0;cursor:pointer}
  .qty input{width:44px;height:32px;background:transparent;color:#fff;border:0;text-align:center}
  .link-danger{color:#fecaca}
  .summary .line{display:flex;justify-content:space-between;margin:6px 0}
  .summary .total{font-weight:700}
  .summary{align-self:start;position:sticky;top:calc(64px + 16px)}
  @media(max-width:900px){.cart-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>

<nav class="nav">
  <div class="container nav-row">
    <a href="index.html#home" class="brand" aria-label="Cafe home">
      <span class="brand-logo" aria-hidden="true"></span>
      <span>Café Aurora</span>
    </a>
    <div class="nav-links" role="navigation" aria-label="primary">
      <a href="index.html#home">Home</a>
      <a href="index.html#items">Items</a>
      <a href="index.html#memories">Memories</a>
      <a href="index.html#offers">Offers</a>
      <a href="cart.html" id="cartLink" class="cart-pill" aria-live="polite">
        <svg class="cart-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 3h2l2 12h10l2-8H7" stroke="#eaffea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="21" r="1.8" fill="#eaffea"/><circle cx="18" cy="21" r="1.8" fill="#eaffea"/></svg>
        <span id="cartCount">0 items</span>
      </a>
      <div id="cartThumbs" class="cart-thumbs" aria-hidden="true"></div>
      <a href="sign-in.html" class="btn" style="padding:8px 12px">Sign In</a>
    </div>
  </div>
</nav>

<section class="container cart-wrap">
  <div class="section-head">
    <h2>Shopping Cart</h2>
  </div>
  <div class="cart-grid">
    <div class="cart-list card">
      <div id="cartRows"></div>
    </div>
    <div class="summary card" style="padding:16px">
      <h3 style="margin:0 0 10px">Order Summary</h3>
      <div class="line"><span>Subtotal</span><span id="sumSubtotal">$0.00</span></div>
      <div class="line"><span>Discounts</span><span id="sumDiscounts">-$0.00</span></div>
      <div class="line total"><span>Total</span><span id="sumTotal">$0.00</span></div>
      <div style="height:1px;background:rgba(148,163,184,.15);margin:12px 0"></div>
      <h4 style="margin:0 0 8px">Payment</h4>
      <button class="btn" id="btnPay" style="width:100%">Proceed to Payment</button>
      <div class="muted-sm" style="margin-top:8px">Demo only. No real charges.</div>
    </div>
  </div>
</section>

<footer style="background:var(--panel);color:var(--muted);padding:32px 0 18px;margin-top:48px;border-top:1px solid rgba(148,163,184,.15)">
  <div class="container" style="display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:16px">
    <div>
      <strong style="color:var(--brand)">Café Aurora</strong> &copy; 2025
      <span style="margin-left:12px">Modern café ordering, mobile-first.</span>
    </div>
    <div style="display:flex;gap:18px">
      <a href="mailto:hello@cafearora.example" style="color:var(--muted)">Contact</a>
      <a href="index.html#offers" style="color:var(--muted)">Offers</a>
    </div>
  </div>
</footer>

<script src="script.js"></script>
<script>
  function renderCart(){
    const rows = document.getElementById('cartRows');
    rows.innerHTML = '';
    const cart = JSON.parse(localStorage.getItem('aurora_cart_v1')||'{}');
    const itemsIndex = (typeof ITEMS !== 'undefined') ? ITEMS.reduce((m,it)=>{m[it.id]=it;return m;}, {}) : {};
    let subtotal = 0, discounts = 0, total = 0;
    Object.entries(cart).forEach(([id, qty])=>{
      const it = itemsIndex[id]; if(!it) return;
      const linePrice = it.price * qty;
      const discEach = it.discount ? (it.price - (it.price*(1-it.discount/100))) : 0;
      const lineDisc = discEach * qty;
      const finalEach = it.price*(1-it.discount/100);
      const lineTotal = finalEach * qty;
      subtotal += linePrice; discounts += lineDisc; total += lineTotal;
      const row = document.createElement('div');
      row.className = 'cart-row';
      row.setAttribute('data-id', id);
      row.innerHTML = `
        <img src="${it.img}" alt="${it.name}">
        <div>
          <div style="font-weight:600">${it.name}</div>
          <div class="muted-sm">${it.discount? it.discount+"% off" : "No discount"}</div>
        </div>
        <div class="right">
          <div class="qty" aria-label="quantity selector">
            <button type="button" data-action="dec" aria-label="decrease">−</button>
            <input type="number" min="1" value="${qty}" aria-label="quantity" readonly>
            <button type="button" data-action="inc" aria-label="increase">+</button>
          </div>
        </div>
        <div class="right">${fmt(finalEach)}</div>
        <div class="right">${fmt(lineTotal)}</div>
        <div class="right"><button class="btn-secondary" data-action="remove">Remove</button></div>
      `;
      rows.appendChild(row);
    });
    document.getElementById('sumSubtotal').textContent = fmt(subtotal);
    document.getElementById('sumDiscounts').textContent = '-' + fmt(discounts).replace('$','');
    document.getElementById('sumTotal').textContent = fmt(total);
    const count = Object.values(cart).reduce((s,q)=>s+q,0);
    document.getElementById('cartCount').textContent = `${count} item${count!==1? 's':''}`;
  }
  function updateCart(id, newQty){
    const cart = JSON.parse(localStorage.getItem('aurora_cart_v1')||'{}');
    if(newQty <= 0){ delete cart[id]; } else { cart[id] = newQty; }
    localStorage.setItem('aurora_cart_v1', JSON.stringify(cart));
    renderCart();
  }
  document.getElementById('cartRows').addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const action = btn.getAttribute('data-action');
    if(!action) return;
    const row = btn.closest('.cart-row'); if(!row) return;
    const id = row.getAttribute('data-id');
    const input = row.querySelector('input[type="number"]');
    let qty = Number(input.value||1);
    if(action === 'inc') qty += 1;
    if(action === 'dec') qty = Math.max(1, qty-1);
    if(action === 'remove') qty = 0;
    updateCart(id, qty);
  });
  document.getElementById('btnPay').addEventListener('click', ()=>{
    try{
      if(typeof isSignedIn === 'function' && !isSignedIn()){
        const ret = encodeURIComponent(location.pathname.replace(/\/$/, '')); 
        location.href = `sign-in.html?return=${ret}`;
        return;
      }
    }catch(e){}
    alert('Demo checkout: Payment processing not implemented.');
  });
  renderCart();
</script>

<!-- Language overlay -->
<div id="langOverlay" class="lang-overlay">
  <div class="lang-card">
    <div class="lang-inner">
      <div class="lang-head">
        <h2>Select your language</h2>
        <span class="lang-default">Default: English</span>
      </div>
      <div id="langGrid" class="lang-grid" aria-live="polite"></div>
    </div>
  </div>
</div>

</body>
</html>


